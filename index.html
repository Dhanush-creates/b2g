<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>SolarScope — Rooftop Intelligence Platform</title>
<script src="https://cdn.tailwindcss.com"></script>
<script src="https://unpkg.com/lucide@latest/dist/umd/lucide.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<link href="https://fonts.googleapis.com/css2?family=Rajdhani:wght@400;500;600;700&family=JetBrains+Mono:wght@400;500&family=Exo+2:wght@300;400;600;700&display=swap" rel="stylesheet"/>

<script>
tailwind.config = {
  theme: {
    extend: {
      colors: {
        solar: { gold: '#fbbf24', glow: '#f59e0b' },
        emerald: { DEFAULT: '#10b981', dim: '#059669' },
        slate: { 950: '#020617' }
      },
      fontFamily: {
        display: ['Rajdhani', 'sans-serif'],
        body: ['Exo 2', 'sans-serif'],
        mono: ['JetBrains Mono', 'monospace'],
      }
    }
  }
}
</script>

<style>
  :root {
    --bg-deep: #0a0f1e;
    --bg-card: #0f172a;
    --bg-panel: #111827;
    --border: #1e293b;
    --gold: #fbbf24;
    --emerald: #10b981;
    --red-alert: #ef4444;
    --text-dim: #64748b;
  }

  * { box-sizing: border-box; margin: 0; padding: 0; }
  body {
    background: var(--bg-deep);
    font-family: 'Exo 2', sans-serif;
    color: #e2e8f0;
    min-height: 100vh;
    overflow-x: hidden;
  }

  body::before {
    content: '';
    position: fixed; inset: 0; z-index: 0;
    background-image:
      linear-gradient(rgba(251,191,36,0.03) 1px, transparent 1px),
      linear-gradient(90deg, rgba(251,191,36,0.03) 1px, transparent 1px);
    background-size: 40px 40px;
    pointer-events: none;
  }

  /* --- LOGIN SPECIFIC STYLES --- */
  .login-card {
      background: #0f172a;
      border: 1px solid #1e293b;
      box-shadow: 0 0 50px rgba(0,0,0,0.5);
      backdrop-filter: blur(10px);
  }
  @keyframes glow {
      0%, 100% { box-shadow: 0 0 20px rgba(251,191,36,0.1); }
      50% { box-shadow: 0 0 40px rgba(251,191,36,0.2); }
  }
  .glow-effect { animation: glow 3s infinite; }

  /* --- DASHBOARD SPECIFIC STYLES --- */
  @keyframes areaPulse {
    0%, 100% { box-shadow: 0 0 0 0 rgba(16,185,129,0.4); }
    50% { box-shadow: 0 0 0 12px rgba(16,185,129,0); }
  }
  .pulse-card { animation: areaPulse 2.5s ease-in-out infinite; }

  @keyframes blink { 0%,100%{opacity:1;} 50%{opacity:0;} }
  .cursor::after {
    content: '|';
    animation: blink 0.8s infinite;
    color: var(--gold);
    margin-left: 2px;
  }

  @keyframes scanLine {
    0% { top: 0; opacity: 1; }
    95% { top: 100%; opacity: 1; }
    100% { top: 100%; opacity: 0; }
  }
  .scan-line {
    position: absolute; left: 0; right: 0; height: 2px;
    background: linear-gradient(90deg, transparent, var(--gold), transparent);
    box-shadow: 0 0 8px var(--gold);
    animation: scanLine 3s linear infinite;
    pointer-events: none;
  }

  @keyframes rotateCross { from{transform:rotate(0deg);} to{transform:rotate(360deg);} }
  .crosshair-ring {
    border: 1px solid rgba(251,191,36,0.5);
    border-radius: 50%;
    animation: rotateCross 8s linear infinite;
  }

  .progress-fill { transition: width 0.1s linear; }
  .gold-glow { text-shadow: 0 0 20px rgba(251,191,36,0.6); }
  .emerald-glow { text-shadow: 0 0 20px rgba(16,185,129,0.6); }

  .metric-card {
    transition: transform 0.2s, box-shadow 0.2s;
    border: 1px solid var(--border);
  }
  .metric-card:hover {
    transform: translateY(-2px);
    box-shadow: 0 8px 32px rgba(251,191,36,0.08);
  }

  .tab-btn { transition: all 0.2s; border-bottom: 2px solid transparent; }
  .tab-btn.active { border-color: var(--gold); color: var(--gold); }
  #roofCanvas { border-radius: 8px; }

  ::-webkit-scrollbar { width: 4px; }
  ::-webkit-scrollbar-track { background: transparent; }
  ::-webkit-scrollbar-thumb { background: #334155; border-radius: 2px; }

  .stamp {
    position: absolute;
    border: 3px solid rgba(16,185,129,0.6);
    border-radius: 4px;
    padding: 4px 10px;
    font-family: 'Rajdhani', sans-serif;
    font-weight: 700;
    font-size: 11px;
    letter-spacing: 2px;
    color: rgba(16,185,129,0.8);
    transform: rotate(-12deg);
    text-transform: uppercase;
  }
  .sidebar-scroll { overflow-y: auto; max-height: calc(100vh - 70px); }
</style>
</head>

<body class="relative z-10">

<div id="loginSection" class="relative z-20 w-full min-h-screen flex items-center justify-center px-6">
    <div class="login-card rounded-2xl p-8 glow-effect w-full max-w-md">
        <div class="text-center mb-8">
            <div class="inline-flex items-center justify-center w-16 h-16 rounded-full mb-4" style="background: linear-gradient(135deg,#fbbf24,#f59e0b); box-shadow: 0 0 20px rgba(251,191,36,0.4);">
                <i data-lucide="sun" class="w-8 h-8 text-slate-900"></i>
            </div>
            <h1 class="text-3xl font-display font-700 tracking-widest text-white" style="font-family: 'Rajdhani';">
                SOLAR<span class="text-amber-400">SCOPE</span>
            </h1>
            <p class="text-slate-500 text-sm mt-2">Institutional Access Portal</p>
        </div>

        <form id="loginForm" class="space-y-5">
            <div>
                <label class="block text-xs font-semibold text-slate-400 uppercase tracking-wider mb-2">Admin ID</label>
                <div class="relative">
                    <i data-lucide="user" class="absolute left-3 top-3 w-4 h-4 text-slate-500"></i>
                    <input type="text" required placeholder="Enter Department ID" 
                        class="w-full bg-slate-950 border border-slate-800 rounded-lg py-2.5 pl-10 pr-4 text-sm focus:outline-none focus:border-amber-400 transition-colors">
                </div>
            </div>
            <div>
                <label class="block text-xs font-semibold text-slate-400 uppercase tracking-wider mb-2">Security Key</label>
                <div class="relative">
                    <i data-lucide="lock" class="absolute left-3 top-3 w-4 h-4 text-slate-500"></i>
                    <input type="password" required placeholder="••••••••" 
                        class="w-full bg-slate-950 border border-slate-800 rounded-lg py-2.5 pl-10 pr-4 text-sm focus:outline-none focus:border-amber-400 transition-colors">
                </div>
            </div>
            <button type="submit" 
                class="w-full py-3 rounded-lg font-bold text-slate-950 transition-all hover:scale-[1.02] active:scale-95 flex items-center justify-center gap-2 mt-4"
                style="background: linear-gradient(135deg,#fbbf24,#f59e0b); box-shadow: 0 4px 15px rgba(251,191,36,0.3);">
                <i data-lucide="log-in" class="w-4 h-4"></i> AUTHORIZE ACCESS
            </button>
        </form>

        <div class="mt-8 pt-6 border-t border-slate-800 text-center">
            <p class="text-xs text-slate-500 flex items-center justify-center gap-2">
                <i data-lucide="shield-check" class="w-3 h-3 text-emerald-500"></i>
                Secure TANGEDCO Node Encryption Active
            </p>
        </div>
    </div>
</div>

<div id="dashboardSection" class="hidden relative z-10 flex flex-col min-h-screen">
    <header class="sticky top-0 z-50 flex items-center justify-between px-6 py-3 border-b" style="background:rgba(10,15,30,0.95); border-color:var(--border); backdrop-filter:blur(12px);">
        <div class="flex items-center gap-3">
            <div class="relative">
              <div class="w-9 h-9 rounded-full flex items-center justify-center" style="background:linear-gradient(135deg,#fbbf24,#f59e0b); box-shadow:0 0 16px rgba(251,191,36,0.5);">
                <i data-lucide="sun" class="w-5 h-5 text-slate-900"></i>
              </div>
              <div class="absolute -inset-1 rounded-full border border-amber-400/30 animate-ping"></div>
            </div>
            <div>
              <span class="text-xl font-display font-700 tracking-widest" style="color:var(--gold);letter-spacing:0.15em;">SOLAR<span class="text-white">SCOPE</span></span>
              <div class="text-xs font-mono" style="color:var(--text-dim); letter-spacing:0.1em;">ROOFTOP INTELLIGENCE v2.4.1</div>
            </div>
        </div>

        <div class="flex items-center gap-3 flex-1 max-w-md mx-8">
            <div class="relative flex-1">
              <i data-lucide="map-pin" class="absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4" style="color:var(--gold);"></i>
              <input id="searchInput" type="text" placeholder="Campus Name / Coordinates..."
                class="w-full pl-10 pr-4 py-2 rounded-lg text-sm font-mono outline-none"
                style="background:#0f172a; border:1px solid var(--border); color:#e2e8f0;"
                value="IIT Madras, Chennai — 13.0101° N, 80.2330° E"
                onkeydown="if(event.key==='Enter') performScan()"/>
            </div>
            <button onclick="performScan()" class="flex items-center gap-2 px-4 py-2 rounded-lg text-sm font-display font-600 tracking-wider transition-all hover:scale-105"
              style="background:linear-gradient(135deg,#fbbf24,#f59e0b); color:#0a0f1e; box-shadow:0 0 20px rgba(251,191,36,0.3);">
              <i data-lucide="scan-line" class="w-4 h-4"></i> SCAN
            </button>
            <input id="apiKeyInput" type="text" placeholder="Google Maps API Key (optional)"
              class="px-3 py-2 rounded-lg text-sm font-mono outline-none"
              style="background:#0f172a; border:1px solid var(--border); color:#e2e8f0; width:200px;"/>
        </div>

        <div class="flex items-center gap-3">
            <div class="flex items-center gap-2 px-3 py-1.5 rounded-lg text-xs font-mono" style="background:#0f172a; border:1px solid var(--border);">
              <div class="w-2 h-2 rounded-full bg-emerald-400 animate-pulse"></div>
              <span style="color:var(--text-dim);">TANGEDCO LIVE</span>
            </div>
            <button onclick="logout()" class="flex items-center gap-2 px-4 py-2 rounded-lg text-sm font-display font-600 tracking-wider"
              style="background:transparent; border:1px solid var(--border); color:#94a3b8;">
              <i data-lucide="log-out" class="w-4 h-4"></i> Logout
            </button>
        </div>
    </header>

    <div id="progressWrap" class="hidden relative h-1" style="background:#0f172a;">
      <div id="progressBar" class="h-full progress-fill" style="background:linear-gradient(90deg,#fbbf24,#10b981); box-shadow:0 0 8px rgba(251,191,36,0.6); width:0%;"></div>
      <div class="absolute right-2 -top-5 text-xs font-mono" style="color:var(--gold);" id="progressLabel">Initializing…</div>
    </div>

    <main class="grid grid-cols-12 gap-0 flex-1">
        <section class="col-span-8 flex flex-col" style="border-right:1px solid var(--border);">
            <div class="flex flex-1 gap-0" style="min-height: 460px;">
                <div class="relative flex-1 overflow-hidden" style="border-bottom:1px solid var(--border);">
                    <svg class="absolute inset-0 w-full h-full" viewBox="0 0 600 420" preserveAspectRatio="xMidYMid slice">
                        <defs>
                            <filter id="glow"><feGaussianBlur stdDeviation="3" result="blur"/><feMerge><feMergeNode in="blur"/><feMergeNode in="SourceGraphic"/></feMerge></filter>
                        </defs>
                        <rect width="600" height="420" fill="#0d1a2e"/>
                        <path d="M0,200 Q150,180 300,210 Q450,240 600,220" stroke="#1e3a5f" stroke-width="20" fill="none" opacity="0.8"/>
                        <path d="M200,0 Q220,100 210,200 Q200,320 215,420" stroke="#1e3a5f" stroke-width="14" fill="none" opacity="0.8"/>
                        <rect x="80" y="70" width="90" height="60" rx="2" fill="#162032" stroke="#1e3a5f" stroke-width="1"/>
                        <rect x="240" y="50" width="120" height="80" rx="2" fill="#162032" stroke="#1e3a5f" stroke-width="1"/>
                        <rect id="targetBuilding" x="240" y="50" width="120" height="80" rx="2" fill="none" stroke="#fbbf24" stroke-width="2" filter="url(#glow)" opacity="0"/>
                    </svg>
                    <video id="cameraFeed" class="hidden absolute inset-0 w-full h-full object-cover" autoplay muted></video>
                    <iframe id="satelliteView" class="hidden absolute inset-0 w-full h-full" frameborder="0"></iframe>
                    <div class="scan-line hidden" id="mapScanLine"></div>
                    <div class="absolute inset-0 flex items-center justify-center pointer-events-none">
                        <div class="relative w-32 h-32">
                            <div class="crosshair-ring absolute inset-0"></div>
                            <div class="absolute top-1/2 left-0 right-0 h-px bg-amber-400/30"></div>
                            <div class="absolute left-1/2 top-0 bottom-0 w-px bg-amber-400/30"></div>
                        </div>
                    </div>
                </div>

                <div class="relative flex flex-col" style="width:280px; border-left:1px solid var(--border); background:var(--bg-card);">
                    <div class="px-4 py-3 border-b flex justify-between items-center" style="border-color:var(--border);">
                        <span class="text-sm font-display font-600 tracking-wider text-amber-400">AI DEEP SCAN</span>
                        <div id="aiDot" class="w-2 h-2 rounded-full bg-slate-700"></div>
                    </div>
                    <div class="p-3 flex-1 flex flex-col gap-3">
                        <canvas id="roofCanvas" width="252" height="180"></canvas>
                        <div class="font-mono text-xs px-3 py-2 rounded bg-slate-950 border border-slate-800">
                            <div class="text-slate-500">STATUS</div>
                            <div id="typewriterEl" class="cursor mt-1 text-amber-400">Awaiting scan…</div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="grid grid-cols-4 border-t border-slate-800">
                <div class="p-4 border-r border-slate-800 bg-slate-900/50">
                    <span class="text-[10px] uppercase tracking-widest text-slate-500 font-display">Total Area</span>
                    <div class="text-2xl font-bold mt-1" id="m-total">—</div>
                </div>
                <div class="p-4 border-r border-slate-800 bg-slate-900/50 pulse-card">
                    <span class="text-[10px] uppercase tracking-widest text-emerald-500 font-display">Usable Area</span>
                    <div class="text-2xl font-bold mt-1 text-emerald-400" id="m-usable">—</div>
                </div>
                <div class="p-4 border-r border-slate-800 bg-slate-900/50">
                    <span class="text-[10px] uppercase tracking-widest text-amber-500 font-display">Est. Capacity</span>
                    <div class="text-2xl font-bold mt-1 text-amber-400" id="m-capacity">—</div>
                </div>
                <div class="p-4 bg-slate-900/50">
                    <span class="text-[10px] uppercase tracking-widest text-amber-500 font-display">ROI Period</span>
                    <div class="text-2xl font-bold mt-1 text-amber-400" id="m-roi">—</div>
                </div>
            </div>

            <div class="flex flex-col border-t border-slate-800">
                <div class="flex gap-4 px-4 pt-2">
                    <button class="tab-btn active px-4 py-2 text-xs font-bold" onclick="switchTab('shadow',this)">SHADOW</button>
                    <button class="tab-btn px-4 py-2 text-xs font-bold text-slate-500" onclick="switchTab('financial',this)">FINANCIAL</button>
                    <button class="tab-btn px-4 py-2 text-xs font-bold text-slate-500" onclick="switchTab('tender',this)">TENDER</button>
                </div>
                <div class="p-4 h-[220px]">
                    <div id="tab-shadow"><canvas id="shadowChart"></canvas></div>
                    <div id="tab-financial" class="hidden"><canvas id="financialChart"></canvas></div>
                    <div id="tab-tender" class="hidden overflow-y-auto h-full">
                        <div class="relative bg-slate-950 p-4 border border-slate-800 text-[10px] font-mono leading-relaxed">
                            <div class="stamp top-2 right-4">APPROVED</div>
                            <p class="text-center font-bold text-amber-400 mb-2">GOVERNMENT OF TAMIL NADU - TANGEDCO</p>
                            <p>Ref: TANGEDCO/SRE/2026/0891</p>
                            <p>Capacity: 120 kWp | Net Metering Ready</p>
                            <p>Est. Annual Generation: 1,68,000 kWh</p>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <aside class="col-span-4 bg-slate-900/80 p-6 sidebar-scroll space-y-6">
            <div class="bg-slate-800/40 p-4 rounded-xl border border-slate-700">
                <h3 class="text-xs font-bold text-amber-400 uppercase tracking-widest mb-3">System Design</h3>
                <div class="space-y-3 text-xs font-mono">
                    <div class="flex justify-between border-b border-slate-700 pb-2"><span>Panels</span><span id="sd-panels" class="text-white">—</span></div>
                    <div class="flex justify-between border-b border-slate-700 pb-2"><span>Annual Gen</span><span id="sd-gen" class="text-emerald-400">—</span></div>
                    <div class="flex justify-between"><span>CO2 Offset</span><span id="sd-co2" class="text-emerald-400">—</span></div>
                </div>
            </div>
            <div class="bg-slate-800/40 p-4 rounded-xl border border-slate-700">
                <h3 class="text-xs font-bold text-amber-400 uppercase tracking-widest mb-3">Financial Summary</h3>
                <div class="space-y-3 text-xs font-mono">
                    <div class="flex justify-between border-b border-slate-700 pb-2"><span>Project Cost</span><span id="fin-cost" class="text-white">—</span></div>
                    <div class="flex justify-between border-b border-slate-700 pb-2"><span>Subsidy</span><span id="fin-subsidy" class="text-emerald-400">—</span></div>
                    <div class="flex justify-between"><span>Annual Savings</span><span id="fin-savings" class="text-emerald-400">—</span></div>
                </div>
            </div>
            <button onclick="performScan()" class="w-full py-4 bg-amber-500 hover:bg-amber-400 text-slate-950 font-bold rounded-xl shadow-lg shadow-amber-500/20 transition-all">RUN FULL SCAN</button>
        </aside>
    </main>
</div>

<script>
lucide.createIcons();

// --- AUTH LOGIC ---
document.getElementById('loginForm').addEventListener('submit', function(e) {
    e.preventDefault();
    const btn = e.target.querySelector('button');
    btn.innerHTML = '<i data-lucide="loader-2" class="animate-spin w-4 h-4"></i> VERIFYING...';
    lucide.createIcons();

    setTimeout(() => {
        document.getElementById('loginSection').classList.add('hidden');
        document.getElementById('dashboardSection').classList.remove('hidden');
        initCharts(); // Initialize charts after showing dashboard
    }, 1200);
});

function logout() {
    location.reload();
}

// --- DASHBOARD LOGIC ---
const canvas = document.getElementById('roofCanvas');
const ctx = canvas.getContext('2d');

function drawRoofBase() {
  ctx.clearRect(0,0,canvas.width,canvas.height);
  ctx.fillStyle = '#0d1a2e';
  ctx.fillRect(0,0,canvas.width,canvas.height);
  ctx.fillStyle = '#162032';
  ctx.beginPath();
  ctx.roundRect(10,20,232,150,4);
  ctx.fill();
}

const zones = [
  [12,22,90,80,'usable'],[104,22,80,80,'usable'],[186,22,54,80,'usable'],
  [12,104,54,64,'shadow'],[198,104,42,64,'obstacle'],[104,40,28,22,'obstacle'],
];

function drawRoofAnalysis(progress=1){
  drawRoofBase();
  const colors = { usable: `rgba(16,185,129,${0.5*progress})`, obstacle: `rgba(239,68,68,${0.6*progress})`, shadow: `rgba(251,191,36,${0.4*progress})` };
  zones.forEach(([x,y,w,h,t],i)=>{
    const delay = i/zones.length;
    if(progress < delay) return;
    ctx.fillStyle = colors[t];
    ctx.fillRect(x,y,w,h);
    ctx.strokeStyle = t==='usable'?'#10b981':t==='obstacle'?'#ef4444':'#fbbf24';
    ctx.strokeRect(x,y,w,h);
  });
}

drawRoofBase();

let shadowChartInst, financialChartInst;
function initCharts(){
    const months = ['Jan','Feb','Mar','Apr','May','Jun','Jul','Aug','Sep','Oct','Nov','Dec'];
    const sCtx = document.getElementById('shadowChart').getContext('2d');
    shadowChartInst = new Chart(sCtx, {
        type:'bar',
        data: { labels: months, datasets: [{label:'Gen (kWh)', data:[1200,1400,1600,1500,1100,900,1000,1200,1300,1500,1400,1200], backgroundColor:'#fbbf24'}] },
        options: { responsive:true, maintainAspectRatio:false, plugins:{legend:{display:false}}, scales:{y:{beginAtZero:true}} }
    });

    const fCtx = document.getElementById('financialChart').getContext('2d');
    financialChartInst = new Chart(fCtx, {
        type:'line',
        data: { labels: months, datasets: [{label:'Savings (₹)', data:[8000,9500,11000,10500,8500,7000,7500,8500,9000,10500,10000,8500], borderColor:'#10b981', tension:0.4}] },
        options: { responsive:true, maintainAspectRatio:false, plugins:{legend:{display:false}}, scales:{y:{beginAtZero:true}} }
    });
}

function switchTab(tab, btn){
  ['shadow','financial','tender'].forEach(t => document.getElementById('tab-'+t).classList.add('hidden'));
  document.getElementById('tab-'+tab).classList.remove('hidden');
  document.querySelectorAll('.tab-btn').forEach(b => b.classList.replace('text-amber-400','text-slate-500'));
  btn.classList.replace('text-slate-500','text-amber-400');
}

function performScan(){
  document.getElementById('progressWrap').classList.remove('hidden');
  document.getElementById('mapScanLine').classList.remove('hidden');
  document.getElementById('aiDot').className = "w-2 h-2 rounded-full bg-amber-400 animate-pulse";
  document.getElementById('typewriterEl').textContent = "Initializing camera and GPS...";

  let lat, lng;
  let cameraStream;

  // Get GPS
  navigator.geolocation.getCurrentPosition(
    (position) => {
      lat = position.coords.latitude;
      lng = position.coords.longitude;
      document.getElementById('searchInput').value = `Current Location — ${lat.toFixed(4)}° N, ${lng.toFixed(4)}° E`;
      document.getElementById('typewriterEl').textContent = "GPS acquired. Accessing camera...";
    },
    (error) => {
      console.error('GPS error:', error);
      // Use default coordinates
      lat = 13.0101;
      lng = 80.2330;
      document.getElementById('typewriterEl').textContent = "GPS unavailable. Using default location. Accessing camera...";
    }
  );

  // Get Camera
  navigator.mediaDevices.getUserMedia({ video: true })
    .then(stream => {
      cameraStream = stream;
      const video = document.getElementById('cameraFeed');
      video.srcObject = stream;
      video.classList.remove('hidden');
      document.getElementById('typewriterEl').textContent = "Camera active. Scanning environment...";
    })
    .catch(err => {
      console.error('Camera error:', err);
      document.getElementById('typewriterEl').textContent = "Camera unavailable. Proceeding with analysis...";
    });

  let width = 0;
  const interval = setInterval(()=>{
    width += 2;
    document.getElementById('progressBar').style.width = width+'%';
    document.getElementById('progressLabel').textContent = `Scanning... ${width}%`;
    if(width > 30 && cameraStream){
      // Switch to satellite view after 30%
      document.getElementById('cameraFeed').classList.add('hidden');
      const iframe = document.getElementById('satelliteView');
      const apiKey = document.getElementById('apiKeyInput').value.trim();
      if(apiKey){
        iframe.src = `https://www.google.com/maps/embed/v1/view?key=${apiKey}&center=${lat || 13.0101},${lng || 80.2330}&zoom=18&maptype=satellite`;
      } else {
        iframe.src = `https://maps.google.com/maps?q=${lat || 13.0101},${lng || 80.2330}&output=embed&t=k&z=18`;
      }
      iframe.classList.remove('hidden');
      document.getElementById('typewriterEl').textContent = "Satellite imagery loaded. Analyzing rooftop...";
      if(cameraStream) cameraStream.getTracks().forEach(track => track.stop());
    }
    drawRoofAnalysis(width/100);
    if(width >= 100){
      clearInterval(interval);
      document.getElementById('progressWrap').classList.add('hidden');
      document.getElementById('satelliteView').classList.add('hidden');
      document.getElementById('aiDot').className = "w-2 h-2 rounded-full bg-emerald-500";
      fillResults();
    }
  }, 40);
}

function fillResults(){
    document.getElementById('m-total').textContent = "1,200 m²";
    document.getElementById('m-usable').textContent = "850 m²";
    document.getElementById('m-capacity').textContent = "120 kWp";
    document.getElementById('m-roi').textContent = "3.8 Yrs";
    document.getElementById('sd-panels').textContent = "218 Nos";
    document.getElementById('sd-gen').textContent = "1,68,000 kWh";
    document.getElementById('sd-co2').textContent = "136 Tons";
    document.getElementById('fin-cost').textContent = "₹72.0 L";
    document.getElementById('fin-subsidy').textContent = "₹21.6 L";
    document.getElementById('fin-savings').textContent = "₹13.2 L/yr";
    document.getElementById('typewriterEl').textContent = "Scan complete. Optimal configuration identified.";
}
</script>
</body>
</html>